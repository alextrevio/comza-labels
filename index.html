<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grupo COMZA ‚Äî Gestor de Etiquetas</title>
    <link rel="icon" href="https://grupocomza.com/cdn/shop/files/GrupoComza_Logo2024_BLACK.png?v=1731972440&width=32" type="image/png">
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;500;600;700;800&family=IBM+Plex+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root{
            --black:#000;--bg1:#0a0a0a;--bg2:#111;--bg3:#181818;--bg4:#222;--bg5:#2a2a2a;
            --border:#1e1e1e;--border2:#2a2a2a;--border3:#333;
            --white:#fff;--t1:#f5f5f5;--t2:#b0b0b0;--t3:#777;--t4:#555;
            --green:#2ecc71;--green-bg:rgba(46,204,113,.1);--green-b:rgba(46,204,113,.25);
            --red:#e74c3c;--red-bg:rgba(231,76,60,.08);--red-b:rgba(231,76,60,.2);
            --amber:#f39c12;--amber-bg:rgba(243,156,18,.08);
            --accent:#2ecc71;
            --font:'Assistant',system-ui,sans-serif;--mono:'IBM Plex Mono',monospace;
            --r:8px;--r2:12px;
        }
        *,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
        body{font-family:var(--font);background:var(--black);color:var(--t1);min-height:100vh;-webkit-font-smoothing:antialiased}
        ::selection{background:var(--green-b);color:var(--green)}
        ::-webkit-scrollbar{width:4px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:var(--bg4);border-radius:2px}
        a{color:inherit;text-decoration:none}

        /* LAYOUT */
        .shell{display:grid;grid-template-columns:240px 1fr;min-height:100vh}

        /* SIDEBAR */
        .sb{background:var(--bg1);border-right:1px solid var(--border);display:flex;flex-direction:column;position:sticky;top:0;height:100vh}
        .sb-brand{padding:24px 20px 20px;display:flex;align-items:center;gap:12px;border-bottom:1px solid var(--border)}
        .sb-logo{height:28px;filter:invert(1) brightness(2)}
        .sb-name{font-weight:700;font-size:15px;letter-spacing:.5px}
        .sb-sub{font-size:10px;color:var(--t3);text-transform:uppercase;letter-spacing:1.5px;margin-top:2px}
        .sb-nav{flex:1;padding:16px 10px;display:flex;flex-direction:column;gap:2px}
        .sb-sec{padding:14px 10px 4px;font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:2px;color:var(--t4)}
        .sb-link{display:flex;align-items:center;gap:10px;padding:9px 10px;border-radius:var(--r);cursor:pointer;font-size:13px;font-weight:500;color:var(--t2);transition:.15s;border:1px solid transparent}
        .sb-link:hover{background:var(--bg3);color:var(--t1)}
        .sb-link.on{background:var(--green-bg);color:var(--green);border-color:var(--green-b)}
        .sb-link svg{width:16px;height:16px;flex-shrink:0;opacity:.6}
        .sb-link.on svg{opacity:1}
        .sb-badge{margin-left:auto;background:var(--green);color:var(--black);font-size:10px;font-weight:700;padding:1px 7px;border-radius:99px;font-family:var(--mono)}
        .sb-ft{padding:14px 20px;border-top:1px solid var(--border)}
        .sb-status{display:flex;align-items:center;gap:7px;font-size:11px;color:var(--t3)}
        .sb-dot{width:6px;height:6px;border-radius:50%;background:var(--t4);flex-shrink:0}
        .sb-dot.on{background:var(--green);box-shadow:0 0 8px rgba(46,204,113,.5)}

        /* MAIN */
        .main{padding:32px 36px;overflow-y:auto;max-height:100vh}

        /* VIEWS */
        .v{display:none;animation:fadeIn .2s ease}.v.on{display:block}
        @keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}

        /* HEADER */
        .hd{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:24px}
        .hd h1{font-size:20px;font-weight:700}.hd .sub{color:var(--t3);font-size:12px;margin-top:2px}
        .hd-act{display:flex;gap:8px}

        /* BUTTONS */
        .btn{display:inline-flex;align-items:center;justify-content:center;gap:6px;padding:8px 16px;border-radius:var(--r);font-family:var(--font);font-size:12.5px;font-weight:600;cursor:pointer;transition:.15s;border:1px solid transparent;outline:none;white-space:nowrap}
        .btn svg{width:14px;height:14px}
        .btn-g{background:var(--green);color:var(--black);border-color:var(--green)}.btn-g:hover{background:#27ae60;box-shadow:0 2px 12px rgba(46,204,113,.25);transform:translateY(-1px)}
        .btn-o{background:transparent;color:var(--t2);border-color:var(--border2)}.btn-o:hover{background:var(--bg3);color:var(--t1)}
        .btn-r{background:var(--red-bg);color:var(--red);border-color:var(--red-b)}.btn-r:hover{background:rgba(231,76,60,.14)}
        .btn:disabled{opacity:.35;pointer-events:none}.btn-sm{padding:5px 10px;font-size:11.5px}.btn-w{width:100%}

        /* INPUTS */
        .fg{margin-bottom:16px}
        .fg label{display:block;font-size:11px;font-weight:600;color:var(--t3);margin-bottom:4px;text-transform:uppercase;letter-spacing:.5px}
        .fg input,.fg select,.fg textarea{width:100%;padding:9px 12px;background:var(--bg2);border:1px solid var(--border2);border-radius:var(--r);color:var(--t1);font-family:var(--font);font-size:13px;transition:.15s;outline:none}
        .fg input:focus,.fg select:focus{border-color:var(--green);box-shadow:0 0 0 2px var(--green-bg)}
        .fg .hint{font-size:10px;color:var(--t4);margin-top:3px}

        /* STATS */
        .stats{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:22px}
        .st{background:var(--bg2);border:1px solid var(--border);border-radius:var(--r2);padding:16px 18px}
        .st-l{font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;color:var(--t4);margin-bottom:4px}
        .st-v{font-size:24px;font-weight:800;font-family:var(--mono);letter-spacing:-.5px}

        /* SEARCH */
        .srch{position:relative;margin-bottom:20px}
        .srch svg{position:absolute;left:12px;top:50%;transform:translateY(-50%);width:15px;height:15px;color:var(--t4)}
        .srch input{width:100%;padding:10px 14px 10px 36px;background:var(--bg2);border:1px solid var(--border);border-radius:var(--r2);color:var(--t1);font-family:var(--font);font-size:13px;outline:none;transition:.15s}
        .srch input:focus{border-color:var(--green);box-shadow:0 0 0 2px var(--green-bg)}
        .srch input::placeholder{color:var(--t4)}

        /* PRODUCT GRID */
        .pg{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px}
        .pc{background:var(--bg2);border:1px solid var(--border);border-radius:var(--r2);overflow:hidden;transition:.2s;cursor:pointer}
        .pc:hover{border-color:var(--green);transform:translateY(-2px);box-shadow:0 8px 20px rgba(0,0,0,.4)}
        .pc-img{width:100%;height:180px;background:var(--bg3);display:grid;place-items:center;overflow:hidden}
        .pc-img img{width:100%;height:100%;object-fit:cover}
        .pc-img .ni{color:var(--t4);font-size:11px}
        .pc-bd{padding:12px 14px}
        .pc-t{font-size:13px;font-weight:600;line-height:1.4;margin-bottom:2px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
        .pc-sku{font-family:var(--mono);font-size:10px;color:var(--green);margin-bottom:8px;letter-spacing:.3px}
        .pc-pr{font-family:var(--mono);font-size:16px;font-weight:700;color:var(--green)}
        .pc-pr .c{font-size:10px;color:var(--t3);font-weight:400;margin-left:2px}
        .pc-stk{margin-top:6px;font-size:10px;color:var(--t3)}
        .pc-ft{padding:8px 14px;border-top:1px solid var(--border);display:flex;gap:6px}
        .pc-ft .btn{flex:1;font-size:10.5px;padding:6px 8px}

        /* CONNECT */
        .cx{max-width:460px;margin:50px auto;background:var(--bg2);border:1px solid var(--border2);border-radius:16px;padding:40px;text-align:center}
        .cx h2{font-size:20px;font-weight:700;margin-bottom:6px}.cx>p{color:var(--t3);font-size:13px;margin-bottom:28px;line-height:1.6}
        .cx-code{background:var(--bg3);border:1px solid var(--border);border-radius:var(--r);padding:14px;font-family:var(--mono);font-size:11px;color:var(--t2);line-height:1.8;text-align:left;margin-bottom:24px}

        /* PANEL */
        .po{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:90;backdrop-filter:blur(3px)}.po.on{display:block}
        .pn{display:none;position:fixed;top:0;right:0;width:480px;height:100vh;background:var(--bg1);border-left:1px solid var(--border);z-index:91;overflow-y:auto;box-shadow:-8px 0 30px rgba(0,0,0,.4)}.pn.on{display:block;animation:slideR .2s ease}
        @keyframes slideR{from{transform:translateX(30px);opacity:0}to{transform:translateX(0);opacity:1}}
        .pn-h{position:sticky;top:0;background:var(--bg1);padding:16px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;z-index:5}
        .pn-h h3{font-size:14px;font-weight:600}.pn-b{padding:20px}
        .pn-img{width:100%;height:180px;background:var(--bg3);border-radius:var(--r);display:grid;place-items:center;overflow:hidden;margin-bottom:20px;border:1px solid var(--border)}
        .pn-img img{width:100%;height:100%;object-fit:cover}
        .pn-act{display:flex;gap:8px;margin-top:20px}.pn-act .btn{flex:1}

        /* LABEL */
        .la{display:grid;grid-template-columns:1fr 1fr;gap:24px;align-items:start}
        .lp-box{background:var(--bg2);border:1px solid var(--border);border-radius:var(--r2);padding:24px;display:flex;flex-direction:column;align-items:center;gap:18px;position:sticky;top:32px}
        .lp-tag{font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:2px;color:var(--t4)}

        /* LABEL PAPER ‚Äî matches physical label exactly */
        .lbl{background:#fff;color:#111;width:380px;padding:30px 26px;border-radius:2px;box-shadow:0 10px 30px rgba(0,0,0,.4);font-family:'Assistant',Arial,sans-serif}
        .lbl-nm{font-size:15px;font-weight:400;text-align:left;color:#555;line-height:1.4;margin-bottom:16px;font-style:italic}
        .lbl-sku{text-align:left;margin-bottom:18px}
        .lbl-sku .p{font-size:16px;color:#000;font-weight:700;font-family:'IBM Plex Mono',monospace}.lbl-sku .v{font-size:42px;font-weight:800;letter-spacing:1px;font-family:'IBM Plex Mono',monospace;color:#000}
        .lbl-rw{display:grid;grid-template-columns:1fr 1fr;margin-bottom:0}
        .lbl-cl{text-align:left;padding:8px 0}
        .lbl-cl .a{font-size:16px;font-weight:800;margin-bottom:2px;color:#000}.lbl-cl .s{font-size:11px;font-weight:800;color:#555;text-transform:uppercase;letter-spacing:.3px}
        .lbl-cl:nth-child(2){text-align:right}
        .lbl-cl:nth-child(2) .a{color:#666}
        .lbl-pb{text-align:center;font-size:22px;font-weight:900;text-transform:uppercase;letter-spacing:4px;padding:16px 0 10px;margin-top:10px;border-top:2px solid #ccc;color:#000}
        .lbl-pr-rw .lbl-cl .a{font-size:18px;font-weight:800}
        .lbl-pr-rw .lbl-cl .s{font-size:12px;font-weight:800}
        .lbl-sp{text-align:center;font-size:14px;color:#555;padding-top:18px;margin-top:16px;border-top:1px solid #ddd;letter-spacing:.5px}
        .lbl-br{text-align:center;margin-top:18px;display:flex;align-items:center;justify-content:center;gap:6px}
        .lbl-br img{height:22px}
        .lbl-br span{font-family:'IBM Plex Mono',monospace;font-size:16px;font-weight:800;letter-spacing:3px;color:#333}
        .lbl-act{display:flex;gap:8px;flex-wrap:wrap;justify-content:center}

        /* PROMO */
        .prb{background:var(--bg3);border:1px dashed var(--border2);border-radius:var(--r);padding:12px;margin-top:4px}
        .prb-h{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
        .prb-h span{font-size:11px;font-weight:700;color:var(--amber)}
        .chk{display:flex;align-items:center;gap:6px;font-size:12px;cursor:pointer}.chk input{accent-color:var(--green);width:14px;height:14px}

        /* SETTINGS */
        .sc{background:var(--bg2);border:1px solid var(--border);border-radius:var(--r2);padding:20px;margin-bottom:14px}
        .sc h3{font-size:14px;font-weight:600;margin-bottom:2px}.sc .desc{font-size:11px;color:var(--t4);margin-bottom:16px}
        .sc-rw{display:flex;align-items:center;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--border)}.sc-rw:last-child{border-bottom:none}
        .tag{display:inline-flex;padding:2px 8px;border-radius:99px;font-size:10px;font-weight:700;font-family:var(--mono)}
        .tag-g{background:var(--green-bg);color:var(--green);border:1px solid var(--green-b)}
        .tag-r{background:var(--red-bg);color:var(--red);border:1px solid var(--red-b)}

        /* TOAST */
        .tst-c{position:fixed;top:16px;right:16px;z-index:200;display:flex;flex-direction:column;gap:5px}
        .tst{background:var(--bg3);border:1px solid var(--border2);border-radius:var(--r);padding:9px 16px;font-size:12px;box-shadow:0 6px 20px rgba(0,0,0,.3);display:flex;align-items:center;gap:7px;animation:tIn .2s ease;min-width:240px}
        .tst.ok{border-left:3px solid var(--green)}.tst.err{border-left:3px solid var(--red)}.tst.inf{border-left:3px solid var(--accent)}
        @keyframes tIn{from{transform:translateX(60px);opacity:0}to{transform:translateX(0);opacity:1}}

        .empty{text-align:center;padding:40px;color:var(--t4)}.empty h3{font-size:14px;color:var(--t2);margin-bottom:3px}.empty p{font-size:12px}
        .spinner{display:inline-block;width:16px;height:16px;border:2px solid var(--border2);border-top-color:var(--green);border-radius:50%;animation:sp .5s linear infinite}
        @keyframes sp{to{transform:rotate(360deg)}}
        .loading{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px;gap:10px;color:var(--t3);font-size:12px}

        @media print{body *{visibility:hidden!important}.lbl,.lbl *{visibility:visible!important}.lbl{position:fixed!important;left:50%!important;top:50%!important;transform:translate(-50%,-50%)!important;box-shadow:none!important;width:90mm!important;padding:6mm!important}}
        @media(max-width:800px){.shell{grid-template-columns:1fr}.sb{display:none}.main{padding:16px}.la{grid-template-columns:1fr}.pn{width:100%}.lbl{width:100%}.pg{grid-template-columns:1fr}.stats{grid-template-columns:repeat(2,1fr)}}
    </style>
</head>
<body>
<div class="shell">
    <aside class="sb">
        <div class="sb-brand">
            <img src="https://grupocomza.com/cdn/shop/files/GrupoComza_Logo2024_BLACK.png?v=1731972440&width=600" alt="COMZA" class="sb-logo">
            <div><div class="sb-name">Grupo Comza</div><div class="sb-sub">Gestor de Etiquetas</div></div>
        </div>
        <nav class="sb-nav">
            <div class="sb-sec">Principal</div>
            <div class="sb-link on" data-v="products" onclick="go('products')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
                Productos <span class="sb-badge" id="nc">0</span>
            </div>
            <div class="sb-link" data-v="label" onclick="go('label')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="6" y="2" width="12" height="20" rx="1"/><line x1="9" y1="6" x2="15" y2="6"/><line x1="9" y1="10" x2="15" y2="10"/><line x1="9" y1="14" x2="12" y2="14"/></svg>
                Imprimir Etiqueta
            </div>
            <div class="sb-sec">Sistema</div>
            <div class="sb-link" data-v="settings" onclick="go('settings')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
                Configuraci√≥n
            </div>
        </nav>
        <div class="sb-ft"><div class="sb-status"><span class="sb-dot" id="dot"></span><span id="dotT">Verificando...</span></div></div>
    </aside>

    <main class="main">
        <!-- CONNECT -->
        <div class="v on" id="v-connect">
            <div class="cx">
                <img src="https://grupocomza.com/cdn/shop/files/GrupoComza_Logo2024_BLACK.png?v=1731972440&width=600" alt="COMZA" style="height:32px;filter:invert(1);margin-bottom:16px">
                <h2>Configura tu conexi√≥n</h2>
                <p>El servidor necesita las credenciales de Shopify en el archivo <code style="background:var(--bg4);padding:2px 6px;border-radius:3px;font-size:11px">.env</code>.</p>
                <div class="cx-code">SHOPIFY_STORE_DOMAIN=tu-tienda<br>SHOPIFY_CLIENT_ID=...<br>SHOPIFY_CLIENT_SECRET=...<br>COMPANY_NAME=COMZA</div>
                <button class="btn btn-g btn-w" onclick="checkConnection()">Verificar Conexi√≥n</button>
                <div style="margin-top:14px"><button class="btn btn-o btn-sm" onclick="loadDemo()">Cargar datos de demo</button></div>
            </div>
        </div>

        <!-- PRODUCTS -->
        <div class="v" id="v-products">
            <div class="hd">
                <div><h1>Productos</h1><div class="sub">Inventario sincronizado con Shopify</div></div>
                <div class="hd-act"><button class="btn btn-o btn-sm" onclick="fetchProducts()"><svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg> Actualizar</button></div>
            </div>
            <div class="stats">
                <div class="st"><div class="st-l">Productos</div><div class="st-v" id="sT">0</div></div>
                <div class="st"><div class="st-l">Con SKU</div><div class="st-v" id="sS">0</div></div>
                <div class="st"><div class="st-l">Sin SKU</div><div class="st-v" id="sN">0</div></div>
                <div class="st"><div class="st-l">Inventario</div><div class="st-v" id="sI">0</div></div>
            </div>
            <div class="srch"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg><input type="text" id="q" placeholder="Buscar por nombre, SKU, tipo o marca..." oninput="filterP()"></div>
            <div class="pg" id="grid"><div class="loading"><div class="spinner"></div>Cargando...</div></div>
        </div>

        <!-- LABEL -->
        <div class="v" id="v-label">
            <div class="hd"><div><h1>Imprimir Etiqueta</h1><div class="sub">Selecciona producto o ingresa datos manualmente</div></div></div>
            <div class="la">
                <div>
                    <div class="fg"><label>Producto</label><select id="lSel" onchange="fillL()"><option value="">‚Äî Seleccionar ‚Äî</option></select></div>
                    <div class="fg"><label>Nombre</label><input type="text" id="lNm" placeholder="Horno Combi Rational SCC WE 202G"></div>
                    <div class="fg"><label>Condici√≥n</label><input type="text" id="lCd" placeholder="Reacondicionado"></div>
                    <div class="fg"><label>SKU</label><input type="text" id="lSk" placeholder="E258" style="font-family:var(--mono);font-size:15px;font-weight:700"></div>
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
                        <div class="fg"><label>Precio IVA incl.</label><input type="text" id="lPI" placeholder="518,400"></div>
                        <div class="fg"><label>Precio efectivo</label><input type="text" id="lPC" placeholder="480,000"></div>
                    </div>
                    <div class="prb">
                        <div class="prb-h"><span>üè∑Ô∏è Promoci√≥n</span><label class="chk"><input type="checkbox" id="lHP" onchange="togPr()"> Activar</label></div>
                        <div id="prF" style="display:none"><div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
                            <div class="fg" style="margin:0"><label>Promo IVA</label><input type="text" id="lPrI" placeholder="473,000"></div>
                            <div class="fg" style="margin:0"><label>Promo efectivo</label><input type="text" id="lPrC" placeholder="430,000"></div>
                        </div></div>
                    </div>
                    <div class="fg" style="margin-top:12px"><label>Especificaciones</label><input type="text" id="lSp" placeholder="Luz 220v / 1 ph / 20 Charolas / Gas"></div>
                    <div class="fg"><label>Marca</label><input type="text" id="lBr"></div>
                    <button class="btn btn-g btn-w" onclick="updL()">Actualizar Vista Previa</button>
                </div>
                <div class="lp-box">
                    <div class="lp-tag">Vista previa</div>
                    <div class="lbl" id="lblP">
                        <div class="lbl-nm" id="L-nm">Horno Combi Rational SCC WE 202G (Reacondicionado)</div>
                        <div class="lbl-sku"><span class="p">SKU: </span><span class="v" id="L-sk">E258</span></div>
                        <div class="lbl-rw">
                            <div class="lbl-cl"><div class="a" id="L-pi">$518,400 MXN</div><div class="s">IVA Incluido</div></div>
                            <div class="lbl-cl"><div class="a" id="L-pc">$480,000 MXN</div><div class="s">Pago en Efectivo</div></div>
                        </div>
                        <div id="L-prW">
                            <div class="lbl-pb">Promoci√≥n</div>
                            <div class="lbl-rw lbl-pr-rw">
                                <div class="lbl-cl"><div class="a" id="L-pri">$473,000 MXN</div><div class="s">IVA Incluido</div></div>
                                <div class="lbl-cl"><div class="a" id="L-prc">$430,000 MXN</div><div class="s">Pago en<br>Efectivo</div></div>
                            </div>
                        </div>
                        <div class="lbl-sp" id="L-sp">Luz 220 v / 1 ph / 20 Charolas / Gas</div>
                        <div class="lbl-br"><img src="https://grupocomza.com/cdn/shop/files/GrupoComza_Logo2024_BLACK.png?v=1731972440&width=200" alt="COMZA"><span id="L-br">COMZA</span></div>
                    </div>
                    <div class="lbl-act">
                        <button class="btn btn-g" onclick="printL()"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg> Imprimir</button>
                        <button class="btn btn-o" onclick="dlPNG()"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg> PNG</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- SETTINGS -->
        <div class="v" id="v-settings">
            <div class="hd"><div><h1>Configuraci√≥n</h1><div class="sub">Conexi√≥n y preferencias</div></div></div>
            <div class="sc"><h3>Conexi√≥n Shopify</h3><div class="desc">Estado de la tienda conectada</div>
                <div class="sc-rw"><div><div style="font-size:12px;font-weight:600">Tienda</div><div style="font-size:11px;color:var(--t3)" id="cfS">‚Äî</div></div><span class="tag tag-r" id="cfT">Desconectada</span></div>
                <div style="margin-top:12px"><button class="btn btn-o btn-sm" onclick="checkConnection()">Verificar conexi√≥n</button></div>
            </div>
            <div class="sc"><h3>Etiquetas</h3><div class="desc">Configuraci√≥n de impresi√≥n</div>
                <div class="fg"><label>Empresa</label><input type="text" id="cfC" value="COMZA"></div>
                <div class="fg"><label>Moneda</label><select id="cfM"><option value="MXN">MXN ‚Äî Peso Mexicano</option><option value="USD">USD ‚Äî D√≥lar Americano</option></select></div>
            </div>
        </div>
    </main>
</div>

<div class="po" id="panO" onclick="clPn()"></div>
<div class="pn" id="pan"><div class="pn-h"><h3>Editar Producto</h3><button class="btn btn-o btn-sm" onclick="clPn()">‚úï</button></div><div class="pn-b" id="panB"></div></div>
<div class="tst-c" id="tC"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
const S={connected:false,store:null,company:'COMZA',currency:'MXN',products:[],demo:false};
const API='';

async function init(){await checkConnection()}

async function checkConnection(){
    try{const r=await fetch(API+'/api/health');const d=await r.json();
        if(d.connected){S.connected=true;S.store=d.store;S.company=d.company||'COMZA';S.demo=false;updSt(true);go('products');await fetchProducts();toast(`Conectado a ${S.store}`,'ok')}
        else{updSt(false);toast('Shopify no configurado','err')}
    }catch(e){updSt(false)}
}

function updSt(on){
    document.getElementById('dot').className='sb-dot'+(on?' on':'');
    document.getElementById('dotT').textContent=on?(S.store||'Conectado'):'Sin conexi√≥n';
    document.getElementById('cfS').textContent=on?S.store:'No conectada';
    const t=document.getElementById('cfT');t.className=on?'tag tag-g':'tag tag-r';t.textContent=on?'Conectada':'Desconectada';
    document.getElementById('lBr').value=S.company;document.getElementById('L-br').textContent=S.company;document.getElementById('cfC').value=S.company;
}

function go(v){
    if(!S.connected&&!S.demo&&v!=='connect'&&v!=='settings'){toast('Conecta tu tienda primero','err');return}
    document.querySelectorAll('.v').forEach(x=>x.classList.remove('on'));document.querySelectorAll('.sb-link').forEach(x=>x.classList.remove('on'));
    const el=document.getElementById('v-'+v);if(el)el.classList.add('on');
    document.querySelector(`.sb-link[data-v="${v}"]`)?.classList.add('on');
    if(v==='label')popSel();
}

async function fetchProducts(){
    if(S.demo)return;const g=document.getElementById('grid');g.innerHTML='<div class="loading"><div class="spinner"></div>Cargando productos de Shopify...</div>';
    try{const r=await fetch(API+'/api/products');const d=await r.json();
        if(d.error){toast(d.error,'err');g.innerHTML=`<div class="empty" style="grid-column:1/-1"><h3>Error</h3><p>${d.error}</p></div>`;return}
        S.products=d.products||[];render(S.products)}catch(e){toast('Error de conexi√≥n','err');g.innerHTML='<div class="empty" style="grid-column:1/-1"><h3>Error</h3><p>Verifica el servidor</p></div>'}
}

function render(p){
    document.getElementById('nc').textContent=p.length;document.getElementById('sT').textContent=p.length;
    document.getElementById('sS').textContent=p.filter(x=>x.sku).length;document.getElementById('sN').textContent=p.filter(x=>!x.sku).length;
    document.getElementById('sI').textContent=p.reduce((a,x)=>a+(x.inventory_quantity||0),0);
    const g=document.getElementById('grid');
    if(!p.length){g.innerHTML='<div class="empty" style="grid-column:1/-1"><h3>Sin productos</h3></div>';return}
    g.innerHTML=p.map(x=>`<div class="pc" onclick="opEd(${x.id})">
        <div class="pc-img">${x.image?`<img src="${x.image}" loading="lazy">`:'<div class="ni"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg></div>'}</div>
        <div class="pc-bd"><div class="pc-t">${esc(x.title)}</div><div class="pc-sku">${x.sku?'SKU: '+esc(x.sku):'<span style="color:var(--t4)">Sin SKU</span>'}</div>
        <div class="pc-pr">$${fN(x.price)}<span class="c">${S.currency}</span></div><div class="pc-stk">Stock: ${x.inventory_quantity||0}</div></div>
        <div class="pc-ft"><button class="btn btn-o" onclick="event.stopPropagation();opEd(${x.id})">Editar</button><button class="btn btn-g" onclick="event.stopPropagation();goL(${x.id})">Etiqueta</button></div></div>`).join('')}

function filterP(){const q=document.getElementById('q').value.toLowerCase().trim();if(!q){render(S.products);return}
    render(S.products.filter(p=>p.title.toLowerCase().includes(q)||p.sku.toLowerCase().includes(q)||(p.product_type||'').toLowerCase().includes(q)||(p.vendor||'').toLowerCase().includes(q)))}

function opEd(id){const p=S.products.find(x=>x.id===id);if(!p)return;
    document.getElementById('panB').innerHTML=`<div class="pn-img">${p.image?`<img src="${p.image}">`:'<div style="color:var(--t4);font-size:11px">Sin imagen</div>'}</div>
        <div class="fg"><label>Nombre</label><input type="text" id="eT" value="${escA(p.title)}"></div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px"><div class="fg"><label>SKU</label><input type="text" id="eS" value="${escA(p.sku)}" style="font-family:var(--mono);font-weight:600"></div><div class="fg"><label>Tipo</label><input type="text" id="eY" value="${escA(p.product_type)}"></div></div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px"><div class="fg"><label>Precio</label><input type="text" id="eP" value="${p.price}"></div><div class="fg"><label>Precio comp.</label><input type="text" id="eC" value="${p.compare_at_price||''}"></div></div>
        <div class="fg"><label>Marca</label><input type="text" id="eV" value="${escA(p.vendor)}"></div>
        <div class="fg"><label>Tags</label><input type="text" id="eG" value="${escA(p.tags)}"></div>
        <div class="fg"><label>Inventario</label><input type="text" value="${p.inventory_quantity}" disabled style="opacity:.4"><div class="hint">Se gestiona en Shopify</div></div>
        <div class="pn-act"><button class="btn btn-o" onclick="clPn()">Cancelar</button><button class="btn btn-g" onclick="savP(${p.id},${p.variant_id})">Guardar</button></div>
        <div style="text-align:center;margin-top:12px"><button class="btn btn-o btn-sm" onclick="goL(${p.id});clPn()">Imprimir etiqueta ‚Üí</button></div>`;
    document.getElementById('pan').classList.add('on');document.getElementById('panO').classList.add('on')}

async function savP(id,vid){
    const u={title:document.getElementById('eT').value,sku:document.getElementById('eS').value,product_type:document.getElementById('eY').value,price:document.getElementById('eP').value,compare_at_price:document.getElementById('eC').value||null,vendor:document.getElementById('eV').value,tags:document.getElementById('eG').value};
    const i=S.products.findIndex(p=>p.id===id);if(i>=0)S.products[i]={...S.products[i],...u};
    if(!S.demo){try{const r=await fetch(API+`/api/products/${id}`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({...u,variants:[{id:vid,sku:u.sku,price:u.price,compare_at_price:u.compare_at_price}]})});const d=await r.json();
        if(d.error)toast('Error: '+JSON.stringify(d.error),'err');else{if(i>=0&&d.product)S.products[i]=d.product;toast('Actualizado en Shopify ‚úì','ok')}}catch(e){toast('Error de red','err')}}
    else toast('Actualizado (demo)','ok');render(S.products);clPn()}

function clPn(){document.getElementById('pan').classList.remove('on');document.getElementById('panO').classList.remove('on')}

// LABEL
function popSel(){const s=document.getElementById('lSel');s.innerHTML='<option value="">‚Äî Seleccionar ‚Äî</option>'+S.products.map(p=>`<option value="${p.id}">${p.sku?'['+p.sku+'] ':''}${p.title}</option>`).join('')}
function fillL(){const id=parseInt(document.getElementById('lSel').value);if(!id)return;const p=S.products.find(x=>x.id===id);if(!p)return;
    document.getElementById('lNm').value=p.title;document.getElementById('lCd').value='';document.getElementById('lSk').value=p.sku;
    document.getElementById('lPI').value=fN(p.price);document.getElementById('lPC').value=fN(Math.round(parseFloat(p.price)/1.16).toString());
    if(p.compare_at_price){document.getElementById('lHP').checked=true;togPr();document.getElementById('lPrI').value=fN(p.compare_at_price);document.getElementById('lPrC').value=fN(Math.round(parseFloat(p.compare_at_price)/1.16).toString())}
    else{document.getElementById('lHP').checked=false;togPr()}
    document.getElementById('lSp').value=p.body_html?p.body_html.replace(/<[^>]*>/g,'').trim():'';document.getElementById('lBr').value=S.company;updL()}
function goL(id){go('label');setTimeout(()=>{document.getElementById('lSel').value=id;fillL()},50)}
function togPr(){document.getElementById('prF').style.display=document.getElementById('lHP').checked?'block':'none'}
function updL(){
    const nm=document.getElementById('lNm').value,cd=document.getElementById('lCd').value;
    document.getElementById('L-nm').textContent=cd?`${nm} (${cd})`:nm;document.getElementById('L-sk').textContent=document.getElementById('lSk').value;
    document.getElementById('L-pi').textContent=`$${document.getElementById('lPI').value} ${S.currency}`;document.getElementById('L-pc').textContent=`$${document.getElementById('lPC').value} ${S.currency}`;
    const pr=document.getElementById('lHP').checked;document.getElementById('L-prW').style.display=pr?'block':'none';
    if(pr){document.getElementById('L-pri').textContent=`$${document.getElementById('lPrI').value} ${S.currency}`;document.getElementById('L-prc').textContent=`$${document.getElementById('lPrC').value} ${S.currency}`}
    document.getElementById('L-sp').textContent=document.getElementById('lSp').value;document.getElementById('L-br').textContent=document.getElementById('lBr').value}
function printL(){updL();window.print()}
async function dlPNG(){updL();try{const c=await html2canvas(document.getElementById('lblP'),{scale:3,backgroundColor:'#fff'});const a=document.createElement('a');a.download=`etiqueta-${document.getElementById('lSk').value||'label'}.png`;a.href=c.toDataURL('image/png');a.click();toast('PNG descargado','ok')}catch(e){toast('Error','err')}}

// DEMO
function loadDemo(){S.connected=true;S.demo=true;S.store='grupocomza.com';S.company='COMZA';
    S.products=[{id:1,title:'Horno Combi Rational SCC WE 202G',body_html:'Luz 220v / 1 ph / 20 Charolas / Gas',vendor:'Rational',product_type:'Hornos',tags:'hornos',sku:'E258',price:'518400.00',compare_at_price:'480000.00',inventory_quantity:2,image:null,variant_id:101,status:'active'},
    {id:2,title:'Refrigerador Industrial 2 Puertas',body_html:'110v / 1 ph / Acero inoxidable',vendor:'True',product_type:'Refrigeraci√≥n',tags:'refrigeracion',sku:'R101',price:'45600.00',compare_at_price:null,inventory_quantity:5,image:null,variant_id:102,status:'active'},
    {id:3,title:'Freidora Doble Canasta Pitco SSH55',body_html:'Gas LP / 2 canastas / 35 lbs',vendor:'Pitco',product_type:'Cocci√≥n',tags:'coccion',sku:'F301',price:'121000.00',compare_at_price:'110000.00',inventory_quantity:4,image:null,variant_id:103,status:'active'},
    {id:4,title:'Amasadora Hobart HR190 190qts',body_html:'220v / 3 ph / 190 qts',vendor:'Hobart',product_type:'Panader√≠a',tags:'panaderia',sku:'E146',price:'150000.00',compare_at_price:null,inventory_quantity:1,image:null,variant_id:104,status:'active'},
    {id:5,title:'Roladora Somerset CDR2000 20"',body_html:'110v / 1 ph / 20 pulgadas',vendor:'Somerset',product_type:'Panader√≠a',tags:'panaderia',sku:'R200',price:'81000.00',compare_at_price:null,inventory_quantity:2,image:null,variant_id:105,status:'active'}];
    updSt(true);render(S.products);go('products');toast('Demo: 5 productos','ok')}

// UTILS
function fN(s){return parseFloat(s||'0').toLocaleString('es-MX',{maximumFractionDigits:0})}
function esc(s){const d=document.createElement('div');d.textContent=s;return d.innerHTML}
function escA(s){return(s||'').replace(/"/g,'&quot;').replace(/'/g,'&#39;')}
function toast(m,t='inf'){const c=document.getElementById('tC'),e=document.createElement('div');const i={ok:'‚úì',err:'‚úó',inf:'‚Ñπ'};e.className=`tst ${t}`;e.innerHTML=`<span>${i[t]||'‚Ñπ'}</span> ${m}`;c.appendChild(e);setTimeout(()=>{e.style.opacity='0';e.style.transform='translateX(50px)';e.style.transition='.2s';setTimeout(()=>e.remove(),200)},3500)}

init();
</script>
</body>
</html>
